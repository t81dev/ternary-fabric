import os
import sys
from lit.formats import ShTest

config.name = "TfmbsMlir"
config.test_format = ShTest()
config.suffixes = ['.mlir']
config.suite_source_root = os.path.dirname(os.path.abspath(__file__))
config.test_source_root = config.suite_source_root
config.test_exec_root = os.path.join(getattr(config, 'toplevel_build_dir', os.getcwd()), 'tests', 'mlir')
config.excludes = ['tfmbs_fusion.mlir', 'tfmbs_multi_fusion.mlir', 'torch_tfmbs.mlir']

python_exec = sys.executable
config.substitutions.append(('%python', python_exec))
mlir_opt_path = lit_config.params.get('MLIR_OPT')
if not mlir_opt_path:
    mlir_opt_path = os.environ.get('MLIR_OPT')
if not mlir_opt_path:
    mlir_opt_path = os.path.join(getattr(config, 'toplevel_build_dir', os.getcwd()), 'bin', 'mlir-opt')
mlir_opt_path = os.path.abspath(mlir_opt_path)
config.substitutions.append(('%mlir-opt', mlir_opt_path))
config.environment['MLIR_OPT'] = mlir_opt_path
filecheck_path = os.path.join(os.path.dirname(mlir_opt_path), 'FileCheck')
filecheck_path = os.path.abspath(filecheck_path)
config.substitutions.append(('%filecheck', filecheck_path))
if sys.platform.startswith('darwin'):
    plugin_name = 'libtfmbs_plugin.dylib'
elif sys.platform.startswith('win'):
    plugin_name = 'tfmbs_plugin.dll'
else:
    plugin_name = 'libtfmbs_plugin.so'
tfmbs_plugin = os.path.join(getattr(config, 'toplevel_build_dir', os.getcwd()), plugin_name)
config.substitutions.append(('%tfmbs-plugin', tfmbs_plugin))
